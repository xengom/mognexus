---
layout: post
title: Browser상의 Front App 최신화하기2  
date:   2025-02-17
last_modified_at: 2025-02-17
category: [Dev Ops]
tags: [Javascript Vuejs]
---


# Issue
사용자가 서비스 사용 중인 상태에서 WebApp(Front Vue App)이 신규 배포되었을 때, 서버에 배포된 따끈따끈한 WebApp과 사용자의 Browser에서 구동중인 WebApp이 서로 다른 버전을 바로보는 Issue가 있었다.
<br/>
```
배포 순서
1. Build 
2. Nexus에 업로드
3. Nexus의 Build된 소스를 서버에 다운로드
4. 3 번에서 다운 받은 소스를 기준으로 Serving 
```
<br/>
배포 순서가 이렇게 된 이상 HMR을 기대하기는 어렵기도 하거니와 HMR을 쓰기에는 WebApp자체가 너무 무거워서 Build 시간만 몇 분씩 걸렸기 때문에 부득이 다음과 같은 방법을 채택했다.

<br/><br/>
# Constraint
1. Backend의 리소스는 가급적 사용하지 않을 것
2. 사용자가 버전 동기화 여부를 선택할 수 있어야 할 것
3. 별도로 관리하지 않아도 동작할 


<br/><br/>
# Solution
여기서 도출한 결과값은 다음과 같다.
1. 배포 시, Build Date를 `process.env`에 저장
2. 같은 값을 `./public`에 `json`파일로 저장
3. 주기적으로 `${domain}/builddate.json`을 호출
4. browser에서 구동중인 webapp의 `process.env > Build Date`와 3 번에서 return받은 `builddate.json`의 값을 비교하여 두 값이 다른 경우 browser 상의 webapp을 새로고침할지 여부를 묻는 popup 노출

<br/><br/>
# Diagrams
## 신규소스 배포 없는 경우
이미 Browser가 최신 버전의 webapp을 구동중인 경우
